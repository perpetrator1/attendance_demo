<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Attendance Report (All Subjects)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container my-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="card-title text-primary">Attendance Report â€” All Subjects</h2>

        <div class="table-responsive">
          <table class="table table-bordered table-striped" id="reportTable">
            <thead class="table-light">
              <tr id="headerRow">
                <th>Name</th>
                <th>Roll</th>
                <!-- subject headers will be added dynamically -->
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <a href="index.html" class="btn btn-link">Back to Marking</a>
      </div>
    </div>
  </div>

<script>
async function loadFullReport() {
  const res = await fetch('/api/report/all');
  const data = await res.json();
  const { subjects, students } = data;

  // header row
  const headerRow = document.getElementById('headerRow');
  headerRow.innerHTML = '<th>Name</th><th>Roll</th>';
  subjects.forEach(subj => {
    headerRow.innerHTML += `<th>${subj.code}<br><small>${subj.name}</small></th>`;
  });

  // table body
  const tbody = document.querySelector('#reportTable tbody');
  tbody.innerHTML = '';
  students.forEach(s => {
    let tr = `<tr><td>${s.name}</td><td>${s.roll}</td>`;
    subjects.forEach(subj => {
      const subjData = s.subjects[subj.code];
      tr += `<td>${subjData.perc}% (${subjData.present}/${subjData.total})</td>`;
    });
    tr += '</tr>';
    tbody.innerHTML += tr;
  });
}

loadFullReport();
</script>
</body>
</html>
